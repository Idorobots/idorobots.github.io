<!DOCTYPE html><html><head><meta charset="utf-8" /><title>System monitor in Emacs mode-line</title><link href="../style/bootstrap.min.css" rel="stylesheet" type="text/css" /><link href="../style/font-awesome.min.css" rel="stylesheet" type="text/css" /><link href="../style/ts.theme.dark.css" rel="stylesheet" type="text/css" /><link href="../style/hljs.theme.hybrid.css" rel="stylesheet" type="text/css" /><link href="../style/blog.css" rel="stylesheet" type="text/css" /><link href="../index.xml" rel="alternate" title="System monitor in Emacs mode-line Feed" type /><link href="../media/favicon.ico" rel="icon" type="image/png" /><script src="../js/jquery-2.2.0.min.js" type="text/javascript"></script><script src="../js/jquery.tablesorter.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/highlight.min.js" type="text/javascript"></script><script src="../js/blog.js" type="text/javascript"></script><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="λ-blog v.1.3.0" name="generator" /><meta content="Idorobots" name="author" /><meta content="Kajetan Rzepecki, Idorobots, dev-blog, devblog, blog, Clojure, Lisp, Erlang, technology, electronics, hacks, computer science" name="keywords" /><meta content="Yes Mom, I *do* robots." name="description" /></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class="container"><div class="navbar-header"><button class="navbar-toggle navbar-brand pull-left" data-target="#navbar-responsive-collapse" data-toggle="collapse" type="button"><div><img src="../media/logo.svg" />idorobots.org</div></button><div class="hidden-xs"><a class="navbar-brand" href=".."><div><img src="../media/logo.svg" />idorobots.org</div></a></div></div><div class="collapse navbar-collapse navbar-right" id="navbar-responsive-collapse"><ul class="nav navbar-nav"><li><a href="https://github.com/Idorobots"><i class="fa fa-github"></i> GitHub</a></li><li><a href="../resume.html"><i class="fa fa-trophy"></i> Resumé</a></li><li><a href="../contact.html"><i class="fa fa-comment"></i> Contact</a></li><li class="divider hidden-sm hidden-md hidden-lg"></li><li class="hidden-sm hidden-md hidden-lg"><a href=".."><i class="fa fa-home"></i> Home</a></li><li class="hidden-sm hidden-md hidden-lg"><a href="../archives.html"><i class="fa fa-archive"></i> Archives</a></li><li class="hidden-sm hidden-md hidden-lg"><a href="../tags/index.html"><i class="fa fa-tags"></i> Tag Cloud</a></li><li class="hidden-sm hidden-md hidden-lg"><a href="../index.xml"><i class="fa fa-feed"></i> Feed</a></li><li class="dropdown hidden-xs"><a href="#"><i class="fa fa-chevron-right"></i></a><ul class="dropdown-menu"><li><a href=".."><i class="fa fa-home"></i> Home</a></li><li><a href="../archives.html"><i class="fa fa-archive"></i> Archives</a></li><li><a href="../tags/index.html"><i class="fa fa-tags"></i> Tag Cloud</a></li><li><a href="../index.xml"><i class="fa fa-feed"></i> Feed</a></li></ul></li></ul></div></div></nav><div class="body-wrap"><article id="page"><div class="container"><header class="page-header"></header><article><header><div class="panel panel-default"><div class="panel-body"><div class="text-center"><h1>System monitor in Emacs mode-line</h1><p>Posted on <time>2012-10-10 17:00</time> by <a href="https://github.com/Idorobots">Idorobots</a></p><nav><a class="tag" href="../tags/emacs.html"><span class="label label-info small">Emacs</span></a> <a class="tag" href="../tags/emacs-lisp.html"><span class="label label-info small">Emacs Lisp</span></a> <a class="tag" href="../tags/hacks.html"><span class="label label-info small">hacks</span></a> <a class="tag" href="../tags/mode-line.html"><span class="label label-info small">mode-line</span></a> <a class="tag" href="../tags/stats.html"><span class="label label-info small">stats</span></a></nav></div></div></div></header><h2><a name="resistance-is-futile..."></a><a href="#resistance-is-futile...">Resistance is futile...</a></h2>As we all know <strong>Emacs</strong> is a <a href='http://www.informatimago.com/linux/emacs-on-user-mode-linux.html'>great operating system</a> and a decent editor, and as such it has been serving me really well - I find myself <a href='http://awsomeborgcubes.webs.com/borg-cube.jpg'>assimilating</a> more and more of my tools and daily activities into the Emacs collective. Recently I realised that <a href='http://conky.sourceforge.net/'>Conky</a> just wouldn't cut it anymore...<p>First of all, I barely look at my desktop. There's just no reason to do that other than checking some of the system stats such as memory usage or CPU load when I'm hacking arround and testing stuff.</p><p>For this particular use-case I figured the Emacs <a href='http://www.emacswiki.org/ModeLine'>mode-line</a> would be perfect to display all the relevant statistics directly in Emacs in such a way that I could glance through them without interrupting my workflow - giving me real-time feedback with minimal distraction. <a name="preview-more"></a><h2><a name="package"></a><a href="#package">Package</a></h2>The <a href='https://github.com/Idorobots/mode-line-stats'>package</a> I wrote contains a bunch of easy to use modules that provide various system stats directly in the Emacs mode-line:</p><ul><li><strong>cpu-stats.el</strong> - provides an easy way to display various CPU stats derived from <code>/proc/stat</code>. Usage:</li></ul><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="lisp">&#40;require 'cpu-stats&#41;
&#40;setq cpu-usage-update-interval 1&#41;
&#40;setq cpu-usage-format &quot;Average: %A CPU0: %C0 CPU1: %C1&quot;&#41;
&#40;cpu-usage-start&#41;
</code></pre><p></div></div></p><ul><li><strong>memory-stats.el</strong> - display many different RAM and SWAP statistics in the mode-line. Usage:</li></ul><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="lisp">&#40;require 'memory-stats&#41;
&#40;setq memory-usage-update-interval 5&#41;
&#40;setq memory-usage-format &quot;Mem: %R Free: %F Swap: %S&quot;&#41;
&#40;memory-usage-start&#41;
</code></pre><p></div></div></p><ul><li><strong>network-speed.el</strong> - displays network load in the mode-line. This one was written by <strong>Vicente Hernando Ara</strong> quite some time ago and cycles the net ever since. Usage:</li></ul><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="lisp">&#40;require 'network-speed&#41;
&#40;setq network-speed-update-interval 5&#41;
&#40;setq network-speed-precision 1&#41;
&#40;setq network-speed-interface-list '&#40;&quot;wlan0&quot; &quot;eth0&quot;&#41;&#41;
&#40;setq network-speed-format-string &quot;Down: %RB Up: %TB&quot;&#41;
&#40;network-speed-start&#41;
</code></pre><p></div></div></p><ul><li><strong>misc-stats.el</strong> - various system and Emacs stats such as load-averages, uptime etc. Usage:</li></ul><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="lisp">&#40;require 'misc-stats&#41;
&#40;setq misc-stats-update-interval 10&#41;
&#40;setq misc-stats-format &quot;Emacs uptime: %E Load average: %L1&quot;&#41;
&#40;misc-stats-start&#41;
</code></pre><p></div></div></p><p>Additionally, there are some system monitors already bundled with Emacs, such as <strong>battery.el</strong>, useful for laptop users.</p><h2><a name="mode-line-hacking"></a><a href="#mode-line-hacking">Mode-line hacking</a></h2>The <a href='https://github.com/Idorobots/mode-line-stats'>package</a> will look something like this out of the box:<p><img src="http://blog.idorobots.org/media/modeline/modeline.png" alt="modeline" /></p><p>...but with enough elbow grease you can make it look like this:</p><p><img src="http://blog.idorobots.org/media/modeline/modeline2.png" alt="modeline2" /></p><p>Let's start with evaluating arbitrary code in the <code>mode-line-format</code> as it's fairly simple.</p><p>You can use either <code>&#40;:eval ...&#41;</code> or <code>&#40;:propertize ...&#41;</code> in order to evaluate some code that returns a string or propertize it similarly to the <code>propertize</code> function:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="lisp">&#40;setq mode-line-format
  &#40;list '&#40;:eval &#40;message &quot;Using `message' here is a bad idea...&quot;&#41;&#41;
        '&#40;:propertize &quot; No really. Stop it!&quot;
                      face font-lock-warning-face&#41;
  &#41;&#41;
</code></pre><p></div></div></p><p>Propertizing mode-line strings gives us an opportunity to add colors to this boring part of the UI. For example in order to color the buffername according to the version control status of its associated file, we can add this to the <code>mode-line-format</code>:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="lisp">&#40;defvar my-vc-alist '&#40;;; Everything is ok:
                      &#40;up-to-date some-green-face&#41;
                      ;; Kinda important:
                      &#40;edited some-yellow-face&#41;
                      &#40;added some-yellow-face&#41;
                      ;; Most important:
                      ;; ...
                     &#41;&#41;

&#40;setq mode-line-format
  &#40;list ;; ...
         '&#40;:eval &#40;let &#40;&#40;file-name &#40;buffer-file-name&#41;&#41;&#41;
              &#40;if file-name
                  &#40;let &#40;&#40;state-face &#40;assoc &#40;vc-state file-name&#41;
                                           my-vc-alist&#41;&#41;
                        &#40;revision &#40;vc-working-revision file-name&#41;&#41;&#41;
                    &#40;propertize &#40;concat &quot;%b&quot;
                                        &#40;when revision
                                          &#40;concat &quot; &#91;&quot; revision &quot;&#93;&quot;&#41;&#41;&#41;
                                'face &#40;cadr state-face&#41;&#41;&#41;
                  &quot;%b&quot;&#41;&#41;&#41;
        ;; ...
  &#41;&#41;
</code></pre><p></div></div></p><p>Custom tool tips are fine too:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="lisp">&#40;setq mode-line-format
  &#40;list ;; ...
        '&#40;:propertize &quot;%@&quot; help-echo &#40;concat &quot;Default directory is: &quot;
                                             default-directory&#41;
                           mouse-face mode-line-highlight&#41;
        ;; ...
  &#41;&#41;
</code></pre><p></div></div></p><p>And a neat little thing - mode-line images. This one is a little trickier since Emacs has a hard time displaying <code>.png</code>'s in the mode-line for some reason... I advise using <code>.xpm</code>'s instead:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="lisp">&#40;defvar some-image &#40;create-image &quot;foo.xpm&quot; 'xpm nil
                                 :ascent 'center&#41;&#41;

&#40;setq mode-line-format
  &#40;list ;; ...
        '&#40;:eval &#40;propertize &quot;unimportant&quot; 'display some-image&#41;&#41;
        ;; ...
  &#41;&#41;
</code></pre><p></div></div></p><p>Lastly, <a href='https://gist.github.com/3866870'>here</a> you will find my lengthy, custom mode-line code<a href='#fn-1' id='fnref1'><sup>1</sup></a>. Happy hacking.</p><p><strong>2016-02-16</strong>: Adjusted some links & tags. <ol class='footnotes'><li id='fn-1'>It does not use all the stuff the package has to offer to elliminate some redundancies.<a href='#fnref1'>&#8617;</a></li></ol></p><footer><div class="row"><div class="hidden-xs col-md-2"></div><div class="col-xs-6 col-md-4"><nav><ul class="pager"><li class="previous"><a href="../entries/asm-development-log-3_-dsls.html"><i class="fa fa-chevron-left" style="margin-right: 5px;"></i><span class="entry-title">ASM development log 3: DSLs</span></a></li></ul></nav></div><div class="col-xs-6 col-md-4"><nav><ul class="pager"><li class="next"><a href="../entries/you-earned-15-xp-in-getting-things-done_.html"><span class="entry-title">You earned 15 XP in Getting Things Done!</span><i class="fa fa-chevron-right" style="margin-left: 5px;"></i></a></li></ul></nav></div></div></footer></article><footer><hr /><div class="row"><div class="text-center"><div class="row"><div>Copyright © 2011-2016 Kajetan "Kajtek" Rzepecki</div><div>All writing licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license">CC BY-SA 4.0</a>. All code released under the <a href="../media/LICENSE" rel="license">MIT license</a> unless otherwise specified.</div></div></div><div class="text-center"><p>Powered by <a href="https://github.com/Idorobots/lambda-blog">λ-blog</a>.</p></div></div></footer></div></article></div></body></html>