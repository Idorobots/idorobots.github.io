<!DOCTYPE html><html><head><meta charset="utf-8" /><title>Template Metaranting</title><link href="../style/bootstrap.min.css" rel="stylesheet" type="text/css" /><link href="../style/font-awesome.min.css" rel="stylesheet" type="text/css" /><link href="../style/ts.theme.dark.css" rel="stylesheet" type="text/css" /><link href="../style/hljs.theme.hybrid.css" rel="stylesheet" type="text/css" /><link href="../style/blog.css" rel="stylesheet" type="text/css" /><link href="../index.xml" rel="alternate" title="Template Metaranting Feed" type /><link href="../media/favicon.ico" rel="icon" type="image/png" /><script src="../js/jquery-2.2.0.min.js" type="text/javascript"></script><script src="../js/jquery.tablesorter.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/highlight.min.js" type="text/javascript"></script><script src="../js/blog.js" type="text/javascript"></script><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="λ-blog v.1.3.3" name="generator" /><meta content="Idorobots" name="author" /><meta content="Kajetan Rzepecki, Idorobots, dev-blog, devblog, blog, Clojure, Lisp, Erlang, technology, electronics, hacks, computer science" name="keywords" /><meta content="Yes Mom, I *do* robots." name="description" /></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class="container"><div class="navbar-header"><button class="navbar-toggle navbar-brand pull-left" data-target="#navbar-responsive-collapse" data-toggle="collapse" type="button"><div><img src="../media/logo.svg" />idorobots.org</div></button><div class="hidden-xs"><a class="navbar-brand" href=".."><div><img src="../media/logo.svg" />idorobots.org</div></a></div></div><div class="collapse navbar-collapse navbar-right" id="navbar-responsive-collapse"><ul class="nav navbar-nav"><li><a href="https://keybase.io/kajtek/"><i class="fa fa-user"> Keybase</i></a></li><li><a href="https://github.com/Idorobots"><i class="fa fa-github"></i> GitHub</a></li><li><a href="../resume.html"><i class="fa fa-trophy"></i> Resumé</a></li><li><a href="../contact.html"><i class="fa fa-comment"></i> Contact</a></li><li class="divider hidden-sm hidden-md hidden-lg"></li><li class="hidden-sm hidden-md hidden-lg"><a href=".."><i class="fa fa-home"></i> Home</a></li><li class="hidden-sm hidden-md hidden-lg"><a href="../archives.html"><i class="fa fa-archive"></i> Archives</a></li><li class="hidden-sm hidden-md hidden-lg"><a href="../tags/index.html"><i class="fa fa-tags"></i> Tag Cloud</a></li><li class="hidden-sm hidden-md hidden-lg"><a href="../index.xml"><i class="fa fa-feed"></i> Feed</a></li><li class="dropdown hidden-xs"><a href="#"><i class="fa fa-chevron-right"></i></a><ul class="dropdown-menu"><li><a href=".."><i class="fa fa-home"></i> Home</a></li><li><a href="../archives.html"><i class="fa fa-archive"></i> Archives</a></li><li><a href="../tags/index.html"><i class="fa fa-tags"></i> Tag Cloud</a></li><li><a href="../index.xml"><i class="fa fa-feed"></i> Feed</a></li></ul></li></ul></div></div></nav><div class="body-wrap"><article id="page"><div class="container"><header class="page-header"></header><article><header><div class="panel panel-default"><div class="panel-body"><div class="text-center"><h1>Template Metaranting</h1><p>Posted on <time>2012-03-07 20:43</time> by <a href="https://github.com/Idorobots">Idorobots</a></p><nav><a class="tag" href="../tags/c++.html"><span class="label label-info small">C++</span></a> <a class="tag" href="../tags/c++11.html"><span class="label label-info small">C++11</span></a> <a class="tag" href="../tags/d-programming-language.html"><span class="label label-info small">D programming language</span></a> <a class="tag" href="../tags/metaprogramming.html"><span class="label label-info small">Metaprogramming</span></a> <a class="tag" href="../tags/object.template-function_arg_.html"><span class="label label-info small">object.template function(arg)</span></a> <a class="tag" href="../tags/templates.html"><span class="label label-info small">templates</span></a></nav></div></div></div></header><p>Here's another post in the series, this time it's C++ vs. the <a href='http://dlang.org/index.html'>D programming language</a>.</p><p>Let's talk about <strong>templates</strong>. If you've ever tried templates in C++ you surely as hell recall the pages and PAGES of compiler errors and seemingly random placement of <code>typename</code> keyword. Trust me, there are EVEN WORSE problems with templates in C++... Consider the following:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="cpp">struct Foo {
  template&lt;int N&gt;
  void bar&#40;&#41; {}

  template&lt;int N&gt;
  struct Bar {};
};

template&lt;typename T&gt;
void f&#40;&#41; {
  T foo;
  foo.template bar&lt;0&gt;&#40;&#41;;         // Line 12
  typename T::template Bar&lt;0&gt; b; // Line 13
}

int main&#40;&#41; {
  f&lt;Foo&gt;&#40;&#41;;
}
</code></pre><p></div></div> <a name="preview-more"></a> This little snippet is pretty simple, but... OH GOD! Lines 12 and 13. <a href='http://www.delica.ca/forum/download/file.php?id=14148'>What the hell?</a></p><p><strong>Line 12</strong> shows the so-called <code>object.template function&lt;arg&gt;&#40;&#41;</code> syntax and it is probably the least known C++ syntax out there. The reason it exists is simple - in this particular corner case the compiler <a href='http://i1.kym-cdn.com/entries/icons/original/000/004/403/Girls.png'>simply... can't... parse... this code</a>. When parsing <code>f&#40;&#41;</code> functions definition it can't possibly know that <code>T foo</code> has a templated member <code>bar</code> and confuses the template opening bracket with the less-than operator, so we end up with an <code>unresolved overloaded function type</code> error. That's harsh.</p><p><strong>Line 13</strong> contains a similar corner case where we need to use all kinds of messed up syntax just to declare a variable. The <code>typename</code> tells the compiler that we want a type because you know, it won't figure it out on its own. Next, we access with a <code>::</code> the templated member type <code>Bar</code> instantiated with a 0. The <code>template</code> is there for the same reason it's found on line 12.</p><p>Here's the semantically equivalent code in the <strong>D programming language</strong>:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="d">struct Foo {
  void bar&#40;int N&#41;&#40;&#41; {}

  struct Bar&#40;int N&#41; {}
}

void f&#40;T&#41;&#40;&#41; {
  T foo;
  foo.bar!0&#40;&#41;; // Line 9
  T.Bar!0 b;   // Line 10
}

void main&#40;&#41; {
  f!Foo&#40;&#41;;
}
</code></pre><p></div></div></p><p>The analogous lines <strong>(9 & 10)</strong> will always mean the same and don't require disambiguation with any keywords.</p><p>C++' template problem may not seem that serious, but imagine more complicated templates and, <a href='http://www.youtube.com/watch?v=TcxpbhM0DaA'>oh snap</a>, debugging their code and all the weird stuff that happens when you forget a random =template= keyword somewhere. <strong>And I didn't even start ranting about...</strong><a href='#fn-1' id='fnref1'><sup>1</sup></a></p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="cpp">// ...C++11.
template &lt;size&#95;t k, class T, class... Ts&gt;
typename enable&#95;if&lt;k != 0, typename tuple&#95;element&lt;k, tuple&lt;T, Ts...&gt;&gt;::type&amp;&gt;::type // WAT
get&#40;tuple&lt;T, Ts...&gt;&amp; t&#41; {
  tuple&lt;Ts...&gt; &amp; super = t;
  return get&lt;k - 1&gt;&#40;super&#41;;
}
</code></pre><p></div></div></p><p>To sum it up, <strong>D's template syntax is simpler</strong>, <strong>corner cases don't exist</strong> <a href='#fn-2' id='fnref2'><sup>2</sup></a> and <strong>declarations are cleaner</strong>. This is a <strong>yet another</strong> reason I like D so much.</p><p><hr /></p><p><strong>2016-02-16</strong>: Adjusted some links & tags. <ol class='footnotes'><li id='fn-1'>The snippet comes from an awesome <a href='http://ecn.channel9.msdn.com/events/GoingNative12/GN12VariadicTemplatesAreFunadic.pdf'>presentation</a> given by Andrei Alexandrescu on the <strong>Going Native 2012</strong> conference a while ago. <del>I didn't get into any details because it's a topic for another rant. Stay tuned.</del><a href='#fnref1'>&#8617;</a></li><li id='fn-2'>Don't quote me on that one.<a href='#fnref2'>&#8617;</a></li></ol></p><footer><div class="row"><div class="hidden-xs col-md-2"></div><div class="col-xs-6 col-md-4"><nav><ul class="pager"><li class="previous"><a href="../entries/romans_-rubies-and-the-d.html"><i class="fa fa-chevron-left" style="margin-right: 5px;"></i><span class="entry-title">Romans, rubies and the D</span></a></li></ul></nav></div><div class="col-xs-6 col-md-4"><nav><ul class="pager"><li class="next"><a href="../entries/templated-monads_-monadic-templates_.html"><span class="entry-title">Templated Monads? Monadic Templates?</span><i class="fa fa-chevron-right" style="margin-left: 5px;"></i></a></li></ul></nav></div></div></footer></article><footer><hr /><div class="row"><div class="text-center"><div class="row"><div>Copyright © 2011-2018 Kajetan "Kajtek" Rzepecki</div><div>All writing licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license">CC BY-SA 4.0</a>. All code released under the <a href="../media/LICENSE" rel="license">MIT license</a> unless otherwise specified.</div></div></div><div class="text-center"><p>Powered by <a href="https://github.com/Idorobots/lambda-blog">λ-blog</a>.</p></div></div></footer></div></article></div></body></html>