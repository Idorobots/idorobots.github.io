<!DOCTYPE html><html><head><meta charset="utf-8" /><title>Running modern GNU/Linux on PowerMac G5 - the complete instruction</title><link href="../style/bootstrap.min.css" rel="stylesheet" type="text/css" /><link href="../style/font-awesome.min.css" rel="stylesheet" type="text/css" /><link href="../style/ts.theme.dark.css" rel="stylesheet" type="text/css" /><link href="../style/hljs.theme.hybrid.css" rel="stylesheet" type="text/css" /><link href="../style/blog.css" rel="stylesheet" type="text/css" /><link href="../index.xml" rel="alternate" title="Running modern GNU/Linux on PowerMac G5 - the complete instruction Feed" type /><link href="../media/favicon.ico" rel="icon" type="image/png" /><script src="../js/jquery-2.2.0.min.js" type="text/javascript"></script><script src="../js/jquery.tablesorter.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/highlight.min.js" type="text/javascript"></script><script src="../js/blog.js" type="text/javascript"></script><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="λ-blog v.1.3.3" name="generator" /><meta content="Idorobots" name="author" /><meta content="Kajetan Rzepecki, Idorobots, dev-blog, devblog, blog, Clojure, Lisp, Erlang, technology, electronics, hacks, computer science" name="keywords" /><meta content="Yes Mom, I *do* robots." name="description" /></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class="container"><div class="navbar-header"><button class="navbar-toggle navbar-brand pull-left" data-target="#navbar-responsive-collapse" data-toggle="collapse" type="button"><div><img src="../media/logo.svg" />idorobots.org</div></button><div class="hidden-xs"><a class="navbar-brand" href=".."><div><img src="../media/logo.svg" />idorobots.org</div></a></div></div><div class="collapse navbar-collapse navbar-right" id="navbar-responsive-collapse"><ul class="nav navbar-nav"><li><a href="https://github.com/Idorobots"><i class="fa fa-github"></i> GitHub</a></li><li><a href="../resume.html"><i class="fa fa-trophy"></i> Resumé</a></li><li><a href="../contact.html"><i class="fa fa-comment"></i> Contact</a></li><li class="divider hidden-sm hidden-md hidden-lg"></li><li class="hidden-sm hidden-md hidden-lg"><a href=".."><i class="fa fa-home"></i> Home</a></li><li class="hidden-sm hidden-md hidden-lg"><a href="../archives.html"><i class="fa fa-archive"></i> Archives</a></li><li class="hidden-sm hidden-md hidden-lg"><a href="../tags/index.html"><i class="fa fa-tags"></i> Tag Cloud</a></li><li class="hidden-sm hidden-md hidden-lg"><a href="../index.xml"><i class="fa fa-feed"></i> Feed</a></li><li class="dropdown hidden-xs"><a href="#"><i class="fa fa-chevron-right"></i></a><ul class="dropdown-menu"><li><a href=".."><i class="fa fa-home"></i> Home</a></li><li><a href="../archives.html"><i class="fa fa-archive"></i> Archives</a></li><li><a href="../tags/index.html"><i class="fa fa-tags"></i> Tag Cloud</a></li><li><a href="../index.xml"><i class="fa fa-feed"></i> Feed</a></li></ul></li></ul></div></div></nav><div class="body-wrap"><article id="page"><div class="container"><header class="page-header"></header><article><header><div class="panel panel-default"><div class="panel-body"><div class="text-center"><h1>Running modern GNU/Linux on PowerMac G5 - the complete instruction</h1><p>Posted on <time>2017-01-16 22:23</time> by <a href="https://github.com/Idorobots">Idorobots</a></p><nav><a class="tag" href="../tags/linux.html"><span class="label label-info small">Linux</span></a> <a class="tag" href="../tags/ppc970.html"><span class="label label-info small">PPC970</span></a> <a class="tag" href="../tags/powerpc.html"><span class="label label-info small">PowerPC</span></a> <a class="tag" href="../tags/raspberry-pi.html"><span class="label label-info small">Raspberry Pi</span></a> <a class="tag" href="../tags/ubuntu.html"><span class="label label-info small">Ubuntu</span></a> <a class="tag" href="../tags/benchmarks.html"><span class="label label-info small">benchmarks</span></a> <a class="tag" href="../tags/i7.html"><span class="label label-info small">i7</span></a></nav></div></div></div></header><p>Recently, I had a craving for some PowerPC action, so I dug up an old <strong>PPC970</strong>-based machine and had some considerable fun playing with it. The machine in question is an early model of double-processor <em>PowerMac G5</em>, version 7.2 to be exact:</p><p><img src="http://blog.idorobots.org/media/ppclinux/works.png" alt="works" /></p><p>I've decided to write this post because these machines are getting old and any sort of info on how to boot GNU/Linux on them is getting sparser by the year. Especially the correct sort. <a name="preview-more"></a> Surprisingly enough, even though Ubuntu has dropped the official support for PowerPC quite early (since <strong>7.04</strong>), there's a strong community still maintaining PowerPC ports of the distro & various packages. In fact, you can download a live ISO image of the most recent version (<strong>16.10</strong> at the time of writing this post) right off <a href='http://cdimage.ubuntu.com/ubuntu/releases/16.10/release/'>the official Ubuntu downloads page</a>. Pretty neat!</p><p>Here's what you're going to need:</p><ul><li>PowerPC-flavored GNU/Linux distribution image of your choice (I used Ubunt <strong>16.04 LTS</strong> but these instructions should apply equally to any other distribution),</li><li>a USB pendrive, at least <strong>8 GB in size</strong> (more on that later),</li><li>PowerMac G5,</li><li>preferably wired preferably Apple keyboard,</li><li>a compatible display.</li></ul><h2><a name="preparation"></a><a href="#preparation">Preparation</a></h2>Start off by downloading an image (let's call it <strong>image.img</strong>) and burning it onto a pendrive. This varies from platform to platform so unless you're using GNU/Linux you'll have to google. In GNU/Linux you can use <code>dd</code> to do that:<p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="scheme"># dd if=image.img of=/dev/sdX
</code></pre><p></div></div></p><p>The <code>/dev/sdX</code> is the block device assigned to your USB pendrive. You can check which one it is by using <code>lsblk</code>. Be sure to use the <strong>correct</strong> block device, as <em>Disk Destroyer</em> is named so for a reason. After the image has been burned onto the USB drive, be sure to flush any kernel IO buffers:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="scheme"># sync
</code></pre><p></div></div></p><p>Now you can plug your USB drive in the PowerMac and proceed to the next section.</p><h2><a name="boot-to-open-firmware"></a><a href="#boot-to-open-firmware">Boot to Open Firmware</a></h2><p>Now here's the fun part - we'll need to boot into the Open Firmware in order to change the boot sequence. This process might be quite random and nerve-racking unless you own an Apple-issued wired keyboard.</p><p>For Apple keyboards:</p><ul><li>Boot your machine while holding <strong>Command + Option + o + f</strong> keys.</li><li>Release the keys once you see the Open Firmware screen.</li></ul><p>For non-Apple, non-wired keyboards:</p><ul><li>Boot your machine while holding <strong>Windows + Alt + o + f</strong> keys.</li><li>Fail to reach the Open Firmware screen several times.</li><li>Try harder.</li><li>Fail to reach the Open Firmware screen.</li><li>Try pressing the combination right after you hear the initial boot up sound.</li><li>Fail to reach the Open Firmware screen a few more times.</li><li>Get awfully discouraged with the whole enterprise.</li><li>Try one last time.</li><li>Try several more times while swearing a lot and randomly pressing and releasing the key combination.</li><li>Release the keys once you see the Open Firmware screen.</li></ul><p>If you fall into the first category - congratulations, you can now wear your smug smile until the end of time, otherwise - don't get discouraged too quickly thanks to the following instructions you'll only have to do this once - for me it was more like <a href='http://i.giphy.com/pYI1hSqUdcBiw.gif'>five or six times</a>.</p><p>If you still didn't manage to boot into the Open Firmware consult the <a href='#troubleshooting'>Troubleshooting</a> section, otherwise make sure your machine always boots into the Open Firmware:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="scheme">&gt; setenv auto-boot? false
</code></pre><p></div></div></p><p><strong>Verify</strong> that you actually set it correctly:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="scheme">&gt; printenv auto-boot?
</code></pre><p></div></div></p><p>Proceed to the next section once you've made sure it prints <code>false</code>.</p><h2><a name="prepare-the-boot-device"></a><a href="#prepare-the-boot-device">Prepare the boot device</a></h2><p>In order to boot from the live ISO image, we'll need to find the device access path of the USB drive and set it up as the main boot device. That's the part in which most of the articles on the web are wrong.</p><p>List the device tree of the machine:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="scheme">&gt; dev / ls
</code></pre><p></div></div></p><p>This will print a rather long device tree of your machine. What your looking for may differ from machine to machine, but in general, scroll with <code>enter</code> until you see an entry with <code>usb</code> string in it. This is the section you're interested in. It list your machine's USB hubs and connected devices - try looking for any name that might represent your USB pendrive, say <code>disk@1</code> or something similar. In my case it was <code>disk@2</code> under <code>usb@b,1</code>, in the <code>pci@4</code> section, so the whole device path is <code>/ht/pci@4/usb@b,1/disk@2</code>. You can verify that this path is correct by issuing the following command:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="scheme">&gt; dev /ht/pci@4/usb@b,1 ls
</code></pre><p></div></div></p><p>It should print out your USB drive's name you found earlier. Now, set up an alias for this device:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="scheme">&gt; devalias ud /ht/pci@4/usb@b,1/disk@2
</code></pre><p></div></div></p><p>Next, configure & verify the main boot device of your machine:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="scheme">&gt; setenv boot-device ud:,\\:tbxi
&gt; printenv boot-device
</code></pre><p></div></div></p><p>And finally, try booting from the USB drive:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="scheme">&gt; mac-boot
</code></pre><p></div></div></p><p>...aaaand if your luck is anything like mine, <a href='https://www.youtube.com/watch?v=XKz8cLC41qs'>it won't work</a>. Proceed to the next section.</p><p>(In the rare event it actually did work - you're done. You can set <code>auto-boot?</code> back to <code>true</code> now.)</p><h2><a name="troubleshooting"></a><a href="#troubleshooting">Troubleshooting</a></h2><p>If you did not reach the Open Firmware step - tough luck. Try getting another keyboard and verifying that your machine is actually working correctly - if there's a red led lit (or flashing) on the main board you might have a hardware issue... Unless you left your machine's mainboard compartment open (without the translucent polycarb air guide). It won't boot without it. <a href='http://i0.kym-cdn.com/photos/images/newsfeed/000/096/044/trollface.jpg'>You did know that, didn't you?</a></p><p>If you did reach the Open Firmware step... Congratulations! You're doing good - you've managed to boot into the Open Firmware and set up the boot device, but it appears not to be working. The fix is surprisingly simple - try swapping the USB port you plug your USB drive into and updating the <code>devalias ud</code> accordingly until it works. For me, the final working path was <code>/ht/pci@4/usb@b/disk@1</code>. If it still doesn't work make sure your USB pendrive is at least 8 GB in size - I didn't manage to boot from any device smaller than that - as Open Firmware appears to require that. It might as well be USB manufacturer related.</p><p><div class="text-center"></p><p>¯&#92;&#95;(ツ)&#95;/¯</p><p></div></p><h2><a name="benchmarks"></a><a href="#benchmarks">Benchmarks</a></h2><p>So now that we finally booted GNU/Linux on the PowerMac G5, we can do some <em>apples to oranges</em> [pun intended] benchmark comparisons between:</p><ul><li>PowerMac - 2 GHz, 2-core PowerPC 970 made in 2003,</li><li>RaspberryPi 2 model B - 4-core 0.9 GHz BCM2709 made in 2015,</li><li>ASUS UX501V - 3.5 GHz, 8-thread, 4-core i7-6700HQ made in 2015.</li></ul><p>(All collected data is available <a href='https://gist.github.com/Idorobots/073bd569cb5573e549aaa7e73819a3c6'>here</a>.)</p><p>Here are some results - bogo-operations per second normalized against the most performant machine:</p><p><img src="http://blog.idorobots.org/media/ppclinux/bench.png" alt="bench" /></p><p>Surprisingly enough, the PowerMac G5 holds up pretty well even though it's nearing its fifteenth birthday. It beats the Raspberry Pi 2 in most of the benchmarks being twice as fast even though it only has two processor cores, as compared to four on the Raspberry Pi. Obviously neither Raspberry Pi 2 nor the PowerMac G5 are a match for the i7 processor, but on some of the benchmarks (<code>queens</code> and <code>fft</code>) the i7 is <strong>merely 6-8 times</strong> faster than the PowerPC 970. Pretty decent performance.</p><footer><div class="row"><div class="hidden-xs col-md-2"></div><div class="col-xs-6 col-md-4"><nav><ul class="pager"><li class="previous"><a href="../entries/promise-as-a-basic-language-feature.html"><i class="fa fa-chevron-left" style="margin-right: 5px;"></i><span class="entry-title">Promise as a basic language feature</span></a></li></ul></nav></div><div class="col-xs-6 col-md-4"><nav><ul class="pager"><li class="next"><a href="../entries/hacking-huawei-e3372-hilink..html"><span class="entry-title">Hacking Huawei E3372 HiLink.</span><i class="fa fa-chevron-right" style="margin-left: 5px;"></i></a></li></ul></nav></div></div></footer></article><footer><hr /><div class="row"><div class="text-center"><div class="row"><div>Copyright © 2011-2017 Kajetan "Kajtek" Rzepecki</div><div>All writing licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license">CC BY-SA 4.0</a>. All code released under the <a href="../media/LICENSE" rel="license">MIT license</a> unless otherwise specified.</div></div></div><div class="text-center"><p>Powered by <a href="https://github.com/Idorobots/lambda-blog">λ-blog</a>.</p></div></div></footer></div></article></div></body></html>