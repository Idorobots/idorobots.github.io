<!DOCTYPE html><html><head><meta charset="utf-8" /><title>LRRHPSE!</title><link href="../style/bootstrap.min.css" rel="stylesheet" type="text/css" /><link href="../style/font-awesome.min.css" rel="stylesheet" type="text/css" /><link href="../style/ts.theme.dark.css" rel="stylesheet" type="text/css" /><link href="../style/hljs.theme.hybrid.css" rel="stylesheet" type="text/css" /><link href="../style/blog.css" rel="stylesheet" type="text/css" /><link href="../index.xml" rel="alternate" title="LRRHPSE! Feed" type /><link href="../media/favicon.ico" rel="icon" type="image/png" /><script src="../js/jquery-2.2.0.min.js" type="text/javascript"></script><script src="../js/jquery.tablesorter.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/highlight.min.js" type="text/javascript"></script><script src="../js/blog.js" type="text/javascript"></script><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="λ-blog v.1.3.3" name="generator" /><meta content="Idorobots" name="author" /><meta content="Kajetan Rzepecki, Idorobots, dev-blog, devblog, blog, Clojure, Lisp, Erlang, technology, electronics, hacks, computer science" name="keywords" /><meta content="Yes Mom, I *do* robots." name="description" /></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class="container"><div class="navbar-header"><button class="navbar-toggle navbar-brand pull-left" data-target="#navbar-responsive-collapse" data-toggle="collapse" type="button"><div><img src="../media/logo.svg" />idorobots.org</div></button><div class="hidden-xs"><a class="navbar-brand" href=".."><div><img src="../media/logo.svg" />idorobots.org</div></a></div></div><div class="collapse navbar-collapse navbar-right" id="navbar-responsive-collapse"><ul class="nav navbar-nav"><li><a href="https://github.com/Idorobots"><i class="fa fa-github"></i> GitHub</a></li><li><a href="../resume.html"><i class="fa fa-trophy"></i> Resumé</a></li><li><a href="../contact.html"><i class="fa fa-comment"></i> Contact</a></li><li class="divider hidden-sm hidden-md hidden-lg"></li><li class="hidden-sm hidden-md hidden-lg"><a href=".."><i class="fa fa-home"></i> Home</a></li><li class="hidden-sm hidden-md hidden-lg"><a href="../archives.html"><i class="fa fa-archive"></i> Archives</a></li><li class="hidden-sm hidden-md hidden-lg"><a href="../tags/index.html"><i class="fa fa-tags"></i> Tag Cloud</a></li><li class="hidden-sm hidden-md hidden-lg"><a href="../index.xml"><i class="fa fa-feed"></i> Feed</a></li><li class="dropdown hidden-xs"><a href="#"><i class="fa fa-chevron-right"></i></a><ul class="dropdown-menu"><li><a href=".."><i class="fa fa-home"></i> Home</a></li><li><a href="../archives.html"><i class="fa fa-archive"></i> Archives</a></li><li><a href="../tags/index.html"><i class="fa fa-tags"></i> Tag Cloud</a></li><li><a href="../index.xml"><i class="fa fa-feed"></i> Feed</a></li></ul></li></ul></div></div></nav><div class="body-wrap"><article id="page"><div class="container"><header class="page-header"></header><article><header><div class="panel panel-default"><div class="panel-body"><div class="text-center"><h1>LRRHPSE!</h1><p>Posted on <time>2011-09-03 21:28</time> by <a href="https://github.com/Idorobots">Idorobots</a></p><nav><a class="tag" href="../tags/c.html"><span class="label label-info small">C</span></a> <a class="tag" href="../tags/c++.html"><span class="label label-info small">C++</span></a> <a class="tag" href="../tags/game-dev.html"><span class="label label-info small">Game Dev</span></a> <a class="tag" href="../tags/lrrh.html"><span class="label label-info small">LRRH</span></a> <a class="tag" href="../tags/sfml.html"><span class="label label-info small">SFML</span></a> <a class="tag" href="../tags/skn-shader.html"><span class="label label-info small">SKN Shader</span></a> <a class="tag" href="../tags/game-editors.html"><span class="label label-info small">game editors</span></a> <a class="tag" href="../tags/particle-systems.html"><span class="label label-info small">particle systems</span></a> <a class="tag" href="../tags/wxwidgets.html"><span class="label label-info small">wxWidgets</span></a></nav></div></div></div></header><p>This post shows the <strong>Particle System</strong> and its editor me and <a href='http://semicoded.wordpress.com/'>Raver</a> wrote for the <a href='https://blog.idorobots.org/entries/lrrh.html'>LRRH</a> project.</p><p><del>Here's some demo-steam:</del> I have since deleted my YouTube channel. <a name="preview-more"></a> This system was implemented while in <a href='http://www.sknshader.pl/'>SKN Shader</a> for <a href='http://code.google.com/p/kapturek/'>this game project</a>, you should <a href='http://czerwonykapturek.wordpress.com/'>check it out</a>, it's pretty cool. You can download the game and this editor <a href='http://code.google.com/p/kapturek/'>here</a>. The ParticleSystem is implemented in <strong>C++</strong>, using bits of <strong>SFML</strong>. The editor uses <strong>SFML</strong> and <strong>wxWidgets</strong> and this is how it looks:</p><p><img src="https://blog.idorobots.org/media/lrrhpse/0.png" alt="0" /></p><p>The UI is pretty simple, but that's all we really need. We have two main areas in the editor:</p><ul><li><strong>Canvas</strong> and animation buttons where we can see our work slowly getting done.</li><li><strong>SidePanel</strong> showing all the parameters describing a <strong>ParticleSystem</strong>.</li></ul><p>The buttons underneath the Canvas control ParticleSystem's animation, we can start, stop and reset it. The tiny "Autogen" checkbox allows the editor to update our new Particle System whenever we edit its parameters.</p><p>The SidePanel has three main areas: <strong>Emitter</strong> area, <strong>Affector</strong> area and <strong>Parameters</strong> area.</p><p>It's worthy to mention something about the design of our ParticleSystem aswell as some of the technical details concerning its implementation... LRRH project being a simple, 2D game required equally simple but extensive particle system, so we've decided to decouple two main aspects of a particle system - particle emitting and particle physics:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="c++">class ParticleSystem : public Renderable {
    std::vector&lt;ParticleEmitter &#42;&gt; emitters;
    std::vector&lt;ParticleAffector &#42;&gt; affectors;
    std::vector&lt;Particle&gt; particles;

    //...
};
</code></pre><p></div></div></p><p>Our <code>ParticleSystem</code> class contains a vector of <code>ParticleEmitters</code>, which generate new <code>Particles</code> according to their inner rules. In fact, <code>ParticleEmitter</code> is just a common interface, so whenever there is a need for some unusual way to spawn particles we can easily implement it. Next, there's a vector of <code>ParticleAffectors</code>, which control particle physics, this too is an abstract class, so we easily can extend our <code>ParticleSystem</code> implementation. Lastly, we have a vector of currently active <code>Particles</code>:</p><p><div class="row"><div class="col-xs-12 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"></p><pre><code class="c++">struct Particle {
    pos2 position;
    vec2 velocity;
    f32 rotation;
    f32 age;
    f32 scale;
    Texture &#42;texture;
    sf::Color color;

    Particle&#40;pos2 pos=pos2&#40;0,0&#41;,
             vec2 vel=vec2&#40;0,0&#41;,
             Texture &#42;tex = NULL&#41;;
};
</code></pre><p></div></div></p><p>...which are really simple.</p><p>A single step of this <code>ParticleSystem</code> consists of allowing <code>ParticleEmitters</code> to spawn new particles, updating all the particles with <code>ParticleAffectors</code> and removing already dead particles (if there are any).</p><p>In the editor, we can add an arbitrary number of <code>ParticleEmitters</code> and <code>ParticleAffectors</code> choosing from:</p><p><img src="https://blog.idorobots.org/media/lrrhpse/1.png" alt="1" /></p><p><img src="https://blog.idorobots.org/media/lrrhpse/2.png" alt="2" /></p><p>Each of these has different properties, but they are rather self-explanatory. <code>ConeEmitter</code> creates a cone of particles, <code>ColorAffector</code> changes particles color, etc. Now that's <a href='http://en.wikipedia.org/wiki/KISS_principle'>KISS</a>. Combining these simple ideas yields some interesting results (excuse the quality, conversions took most of it):</p><p><del>A little camp fire.</del> Yeah, the no-YouTube-account thing...</p><p><del>Autumn leaves. (This one got a little corrupted, good job recordMyDesktop!)</del></p><p><del>Drunk and cartoony, anyone?</del></p><p>This one was following Little Red Riding Hood in-game for a moment but the rest of the team did not approve <a href='http://realsolutions4life.com/wp-content/uploads/2011/07/boy-rolling-eyes.jpg'>for some reason</a>.</p><h2><a name="let_s-now-create-a-particle-system_"></a><a href="#let_s-now-create-a-particle-system_">Let's now create a particle system!</a></h2>We'll try to create a toxic looking cloud effect. Let's start from scratch:<p><img src="https://blog.idorobots.org/media/lrrhpse/3.png" alt="3" /></p><p>First we need to choose an emitter, we want it to be cloudy, so <code>ConeEmitter</code> is our choice:</p><p><img src="https://blog.idorobots.org/media/lrrhpse/4.png" alt="4" /></p><p>Setting the angle to 360 makes it spawn particles in every direction. We edit <code>ConeEmitters</code> properties selecting it from the Emitters list and editing fields in the Parameters list:</p><p><img src="https://blog.idorobots.org/media/lrrhpse/5.png" alt="5" /></p><p>Don't forget to add a texture. I'll use some simple, white dot:</p><p><img src="https://blog.idorobots.org/media/lrrhpse/6.png" alt="6" /></p><p>Now we need a <code>ConstAffector</code> - it simply updates each particles position according to its velocity:</p><p><img src="https://blog.idorobots.org/media/lrrhpse/7.png" alt="7" /></p><p>It's a simple affector, so we only get to set its stop time making it stop updating particles after 3 seconds:</p><p><img src="https://blog.idorobots.org/media/lrrhpse/8.png" alt="8" /></p><p>This is what we have so far, not quite toxic enough:</p><p><img src="https://blog.idorobots.org/media/lrrhpse/9.png" alt="9" /></p><p>Let's add a <code>ColorAffector</code>:</p><p><img src="https://blog.idorobots.org/media/lrrhpse/10.png" alt="10" /></p><p>Pushing the button next to the color value will open up this color selection window (excuse my locale):</p><p><img src="https://blog.idorobots.org/media/lrrhpse/11.png" alt="11" /></p><p>We'll use it to choose starting and ending colors. Don't forget the alfa, clouds are usually half-transparent (don't ask me, that's just how the Universe works):</p><p><img src="https://blog.idorobots.org/media/lrrhpse/12.png" alt="12" /></p><p>(Note that the <code>ParticleSystem</code> changed right away.) Now we need a <code>ScaleAffector</code>, which will grow us some yummy particles:</p><p><img src="https://blog.idorobots.org/media/lrrhpse/13.png" alt="13" /></p><p>This is the effect so far, it's rather thin if you ask me:</p><p><img src="https://blog.idorobots.org/media/lrrhpse/14.png" alt="14" /></p><p>Let's adjust the spawn time of our <code>ConeEmitter</code>:</p><p><img src="https://blog.idorobots.org/media/lrrhpse/15.png" alt="15" /></p><p>(I tweaked the <code>ScaleAffectors</code> starting scale aswell.) That's more like it:</p><p><img src="https://blog.idorobots.org/media/lrrhpse/16.png" alt="16" /></p><p><del>Here's the vid of this <code>ParticleSystem</code> in action:</del> Still no YouTube account.</p><p>Pretty decent effect for so little time spent on tweaking it, isn't it? Don't forget to save your work!</p><p><strong>2016-02-18</strong>: Adjusted some links & tags.</p><footer><div class="row"><div class="hidden-xs col-md-2"></div><div class="col-xs-6 col-md-4"><nav><ul class="pager"><li class="previous"><a href="../entries/chaosnake.html"><i class="fa fa-chevron-left" style="margin-right: 5px;"></i><span class="entry-title">ChaoSnake</span></a></li></ul></nav></div><div class="col-xs-6 col-md-4"><nav><ul class="pager"><li class="next"><a href="../entries/asm-development-log-1_-oliviabot.html"><span class="entry-title">ASM development log 1: OliviaBOT</span><i class="fa fa-chevron-right" style="margin-left: 5px;"></i></a></li></ul></nav></div></div></footer></article><footer><hr /><div class="row"><div class="text-center"><div class="row"><div>Copyright © 2011-2018 Kajetan "Kajtek" Rzepecki</div><div>All writing licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license">CC BY-SA 4.0</a>. All code released under the <a href="../media/LICENSE" rel="license">MIT license</a> unless otherwise specified.</div></div></div><div class="text-center"><p>Powered by <a href="https://github.com/Idorobots/lambda-blog">λ-blog</a>.</p></div></div></footer></div></article></div></body></html>